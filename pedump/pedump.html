
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

<body>


<style type="text/css">

body {
    margin:20px;
    padding:0px;
}

h1,h2,h3,h4,h5,h6 {
    border-bottom:1px dashed #ddd;
    padding-lefg:1px;
    margin-left:-9px;
    font-weight: bold;
}

table {
    border-collapse: collapse;
}

.toc {
    float:right;
    margin:10px;
    padding-right:10px;
    background-color:#FFFFFF;
    border:1px dotted #CCCCCC;
}

.codehilitetable {
    display:block;
    width:95%;
    padding-left:5px;
    border-width:1px 1px 1px 3px;
    border-style:solid;
    border-color:#CCCCCC;
    background-color:#F7F7F7;
    box-shadow: 0 0 1em #eee;
}

.mdtable tr { border: 1px solid #000000; }
.mdtable th { border: 1px solid #000000; padding: 2px; background-color: #f7f7f7;}
.mdtable td { border: 1px solid #000000; padding: 2px;}

.linenos {
    width: 20px;
}


.codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #ffffff; }
.codehilite .c { color: #888888 } /* Comment */
.codehilite .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.codehilite .k { color: #008800; font-weight: bold } /* Keyword */
.codehilite .o { color: #333333 } /* Operator */
.codehilite .ch { color: #888888 } /* Comment.Hashbang */
.codehilite .cm { color: #888888 } /* Comment.Multiline */
.codehilite .cp { color: #557799 } /* Comment.Preproc */
.codehilite .cpf { color: #888888 } /* Comment.PreprocFile */
.codehilite .c1 { color: #888888 } /* Comment.Single */
.codehilite .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.codehilite .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.codehilite .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.codehilite .s { background-color: #fff0f0 } /* Literal.String */
.codehilite .na { color: #0000CC } /* Name.Attribute */
.codehilite .nb { color: #007020 } /* Name.Builtin */
.codehilite .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.codehilite .no { color: #003366; font-weight: bold } /* Name.Constant */
.codehilite .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.codehilite .ni { color: #880000; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.codehilite .nl { color: #997700; font-weight: bold } /* Name.Label */
.codehilite .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #007700 } /* Name.Tag */
.codehilite .nv { color: #996633 } /* Name.Variable */
.codehilite .ow { color: #000000; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.codehilite .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.codehilite .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.codehilite .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.codehilite .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.codehilite .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.codehilite .sc { color: #0044DD } /* Literal.String.Char */
.codehilite .sd { color: #DD4422 } /* Literal.String.Doc */
.codehilite .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.codehilite .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.codehilite .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.codehilite .si { background-color: #eeeeee } /* Literal.String.Interpol */
.codehilite .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.codehilite .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.codehilite .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.codehilite .ss { color: #AA6600 } /* Literal.String.Symbol */
.codehilite .bp { color: #007020 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #336699 } /* Name.Variable.Class */
.codehilite .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.codehilite .vi { color: #3333BB } /* Name.Variable.Instance */
.codehilite .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */

.codehilite  {
    width:100%;
    background: #f7f7f7;
}

</style>
<h1 id="pedump">PEDUMP</h1>
<h2 id="_1">一、文件头</h2>
<p>在发布Windows版的程序时，在动态链接的时候如何找到依赖的DLL？
其实可以直接解析EXE和DLL程序，得到所有的依赖关系。
Windows的PE文件格式如下，在一个NT的文件格式前附加了一个DOS兼容文件头：</p>
<table class="mdtable">
<thead>
<tr>
<th align="center">EXE/DLL</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">DOS Header</td>
</tr>
<tr>
<td align="center">NT  Magic</td>
</tr>
<tr>
<td align="center">NT  Header</td>
</tr>
<tr>
<td align="center">Data</td>
</tr>
</tbody>
</table>
<p>例如一个Windows的EXE文件的前128个字节数据如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Offset      0  1  2  3  4  5  6  7   8  9  A  B  C  D  E  F

00000000   4D 5A 90 00 03 00 00 00  04 00 00 00 FF FF 00 00   MZ..............
00000010   B8 00 00 00 00 00 00 00  40 00 00 00 00 00 00 00   ................
00000020   00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00   ................
                                               +-----------+
00000030   00 00 00 00 00 00 00 00  00 00 00 00|80 00 00 00|  ................
                                               +-----------+
00000040   0E 1F BA 0E 00 B4 09 CD  21 B8 01 4C CD 21 54 68   ..............Th
00000050   69 73 20 70 72 6F 67 72  61 6D 20 63 61 6E 6E 6F   is program canno
00000060   74 20 62 65 20 72 75 6E  20 69 6E 20 44 4F 53 20   t be run in DOS 
00000070   6D 6F 64 65 2E 0D 0D 0A  24 00 00 00 00 00 00 00   mode............
</pre></div>
</td></tr></table>

<p>对于Windows下的EXE和DLL程序，这128个字节基本就是一样的，前64个字节（0x00000000-0x0000003F）就是DOS文件头，
紧接着的64个字节是一个DOS程序，如果在DOS下运行，就会输出"This program cannot be run in DOS mode."
这段话。</p>
<p>在MinGW GCC自带的 <code>winnt.h</code> 里可以看到IMAGE_DOS_HEADER的定义：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">_IMAGE_DOS_HEADER</span> <span class="p">{</span>
  <span class="n">WORD</span> <span class="n">e_magic</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">e_cblp</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">e_cp</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">e_crlc</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">e_cparhdr</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">e_minalloc</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">e_maxalloc</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">e_ss</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">e_sp</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">e_csum</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">e_ip</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">e_cs</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">e_lfarlc</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">e_ovno</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">e_res</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
  <span class="n">WORD</span> <span class="n">e_oemid</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">e_oeminfo</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">e_res2</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
  <span class="n">LONG</span> <span class="n">e_lfanew</span><span class="p">;</span>
<span class="p">}</span> <span class="n">IMAGE_DOS_HEADER</span><span class="p">,</span><span class="o">*</span><span class="n">PIMAGE_DOS_HEADER</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>其中magic固定为"MZ"，e_lfanew（已经在上面的例子里画了一个框）指向新的NT文件头的位置，
也就是0x00000080，数据如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Offset      0  1  2  3  4  5  6  7   8  9  A  B  C  D  E  F

00000080   50 45 00 00 64 86 10 00  C1 E9 C7 57 00 5A 00 00   PE..............
00000090   DC 03 00 00 F0 26 20                               ....
</pre></div>
</td></tr></table>

<p>NT的文件头定义如下，包含一个Magic，一个文件头，一个扩展的文件头，几个Sections：</p>
<table class="mdtable">
<thead>
<tr>
<th align="center">PE File</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">NT Magic</td>
</tr>
<tr>
<td align="center">NT Header</td>
</tr>
<tr>
<td align="center">NT Opt Header</td>
</tr>
<tr>
<td align="center">Sections Table</td>
</tr>
<tr>
<td align="center">Sections Data</td>
</tr>
</tbody>
</table>
<p>前4个字节对应PE的magic，为"PE\x00\x00"，IMAGE_FILE_HEADER的定义如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">_IMAGE_FILE_HEADER</span> <span class="p">{</span>
  <span class="n">WORD</span> <span class="n">Machine</span><span class="p">;</span>                             <span class="c1">//目标机器的类型</span>
  <span class="n">WORD</span> <span class="n">NumberOfSections</span><span class="p">;</span>                    <span class="c1">//PE有多少个Sections</span>
  <span class="n">DWORD</span> <span class="n">TimeDateStamp</span><span class="p">;</span>                      <span class="c1">//PE的创建时间</span>
  <span class="n">DWORD</span> <span class="n">PointerToSymbolTable</span><span class="p">;</span>               <span class="c1">//符号表的位置</span>
  <span class="n">DWORD</span> <span class="n">NumberOfSymbols</span><span class="p">;</span>                    <span class="c1">//符号表的个数</span>
  <span class="n">WORD</span> <span class="n">SizeOfOptionalHeader</span><span class="p">;</span>                <span class="c1">//扩展文件头的大小（字节）</span>
  <span class="n">WORD</span> <span class="n">Characteristics</span><span class="p">;</span>                     <span class="c1">//特殊标记</span>
<span class="p">}</span> <span class="n">IMAGE_FILE_HEADER</span><span class="p">,</span><span class="o">*</span><span class="n">PIMAGE_FILE_HEADER</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>那么如何判断是32位还是64位呢？从OptionalHeader可以知道，先看看具体的定义，先看32位的：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">_IMAGE_OPTIONAL_HEADER</span> <span class="p">{</span>
  <span class="n">WORD</span> <span class="n">Magic</span><span class="p">;</span>
  <span class="n">BYTE</span> <span class="n">MajorLinkerVersion</span><span class="p">;</span>
  <span class="n">BYTE</span> <span class="n">MinorLinkerVersion</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">SizeOfCode</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">SizeOfInitializedData</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">SizeOfUninitializedData</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">AddressOfEntryPoint</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">BaseOfCode</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">BaseOfData</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">ImageBase</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">SectionAlignment</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">FileAlignment</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">MajorOperatingSystemVersion</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">MinorOperatingSystemVersion</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">MajorImageVersion</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">MinorImageVersion</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">MajorSubsystemVersion</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">MinorSubsystemVersion</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">Win32VersionValue</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">SizeOfImage</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">SizeOfHeaders</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">CheckSum</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">Subsystem</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">DllCharacteristics</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">SizeOfStackReserve</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">SizeOfStackCommit</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">SizeOfHeapReserve</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">SizeOfHeapCommit</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">LoaderFlags</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">NumberOfRvaAndSizes</span><span class="p">;</span>
  <span class="n">IMAGE_DATA_DIRECTORY</span> <span class="n">DataDirectory</span><span class="p">[</span><span class="n">IMAGE_NUMBEROF_DIRECTORY_ENTRIES</span><span class="p">];</span>
<span class="p">}</span> <span class="n">IMAGE_OPTIONAL_HEADER32</span><span class="p">,</span><span class="o">*</span><span class="n">PIMAGE_OPTIONAL_HEADER32</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>再看看64位的定义：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">_IMAGE_OPTIONAL_HEADER64</span> <span class="p">{</span>
  <span class="n">WORD</span> <span class="n">Magic</span><span class="p">;</span>
  <span class="n">BYTE</span> <span class="n">MajorLinkerVersion</span><span class="p">;</span>
  <span class="n">BYTE</span> <span class="n">MinorLinkerVersion</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">SizeOfCode</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">SizeOfInitializedData</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">SizeOfUninitializedData</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">AddressOfEntryPoint</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">BaseOfCode</span><span class="p">;</span>
  <span class="n">ULONGLONG</span> <span class="n">ImageBase</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">SectionAlignment</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">FileAlignment</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">MajorOperatingSystemVersion</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">MinorOperatingSystemVersion</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">MajorImageVersion</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">MinorImageVersion</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">MajorSubsystemVersion</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">MinorSubsystemVersion</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">Win32VersionValue</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">SizeOfImage</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">SizeOfHeaders</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">CheckSum</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">Subsystem</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">DllCharacteristics</span><span class="p">;</span>
  <span class="n">ULONGLONG</span> <span class="n">SizeOfStackReserve</span><span class="p">;</span>
  <span class="n">ULONGLONG</span> <span class="n">SizeOfStackCommit</span><span class="p">;</span>
  <span class="n">ULONGLONG</span> <span class="n">SizeOfHeapReserve</span><span class="p">;</span>
  <span class="n">ULONGLONG</span> <span class="n">SizeOfHeapCommit</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">LoaderFlags</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">NumberOfRvaAndSizes</span><span class="p">;</span>
  <span class="n">IMAGE_DATA_DIRECTORY</span> <span class="n">DataDirectory</span><span class="p">[</span><span class="n">IMAGE_NUMBEROF_DIRECTORY_ENTRIES</span><span class="p">];</span>
<span class="p">}</span> <span class="n">IMAGE_OPTIONAL_HEADER64</span><span class="p">,</span><span class="o">*</span><span class="n">PIMAGE_OPTIONAL_HEADER64</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>在两个结构的第一个字段都是Magic，具体的位置在 0x00000098 开始的2个字节，
对于32位是0x010B，对于64位是0x020B。以下这个就是64位的：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Offset      0  1  2  3  4  5  6  7   8  9  A  B  C  D  E  F

00000090                            0B 02 02 19 00 1C 00 00   .................
000000A0   00 3C 00 00 00 0A 00 00  E0 13 00 00 00 10 00 00   .................
</pre></div>
</td></tr></table>

<p>到此已经可以写一个判断EXE/DLL文件基本信息的程序了，DosHeader到FileHeader可以直接用fread读取，
OptionalHeader以后单独处理，在OptionalHeader读取SizeOfOptionalHeader后，再读取Sections。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">pedump_t</span> <span class="p">{</span>
    <span class="n">IMAGE_DOS_HEADER</span>        <span class="n">DosHeader</span><span class="p">;</span>
    <span class="n">DWORD</span>                   <span class="n">Signature</span><span class="p">;</span>
    <span class="n">IMAGE_FILE_HEADER</span>       <span class="n">FileHeader</span><span class="p">;</span>
    <span class="k">union</span> <span class="p">{</span>
    <span class="n">IMAGE_OPTIONAL_HEADER32</span> <span class="n">Header32</span><span class="p">;</span>
    <span class="n">IMAGE_OPTIONAL_HEADER64</span> <span class="n">Header64</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">OptionalHeader</span><span class="p">;</span>
    <span class="n">PIMAGE_SECTION_HEADER</span>   <span class="n">sections</span><span class="p">;</span>
<span class="p">}</span><span class="n">pedump_t</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p><span></span></p>
<p>打印信息的程序片段如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">pe</span><span class="o">-&gt;</span><span class="n">OptionalHeader</span><span class="p">.</span><span class="n">Header32</span><span class="p">.</span><span class="n">Magic</span> <span class="o">==</span> <span class="n">IMAGE_NT_OPTIONAL_HDR32_MAGIC</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;PE32 &quot;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pe</span><span class="o">-&gt;</span><span class="n">OptionalHeader</span><span class="p">.</span><span class="n">Header64</span><span class="p">.</span><span class="n">Magic</span> <span class="o">==</span> <span class="n">IMAGE_NT_OPTIONAL_HDR64_MAGIC</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;PE32+ &quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">pe</span><span class="o">-&gt;</span><span class="n">FileHeader</span><span class="p">.</span><span class="n">Characteristics</span> <span class="o">&amp;</span> <span class="n">IMAGE_FILE_EXECUTABLE_IMAGE</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;executable &quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">pe</span><span class="o">-&gt;</span><span class="n">FileHeader</span><span class="p">.</span><span class="n">Characteristics</span> <span class="o">&amp;</span> <span class="n">IMAGE_FILE_DLL</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;(DLL) &quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">pe</span><span class="o">-&gt;</span><span class="n">FileHeader</span><span class="p">.</span><span class="n">Characteristics</span> <span class="o">&amp;</span> <span class="n">IMAGE_FILE_32BIT_MACHINE</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;(32bits) &quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">pe</span><span class="o">-&gt;</span><span class="n">FileHeader</span><span class="p">.</span><span class="n">Machine</span> <span class="o">==</span> <span class="n">IMAGE_FILE_MACHINE_I386</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pe</span><span class="o">-&gt;</span><span class="n">OptionalHeader</span><span class="p">.</span><span class="n">Header32</span><span class="p">.</span><span class="n">Subsystem</span> <span class="o">==</span> <span class="n">IMAGE_SUBSYSTEM_WINDOWS_CUI</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;(console) &quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pe</span><span class="o">-&gt;</span><span class="n">OptionalHeader</span><span class="p">.</span><span class="n">Header32</span><span class="p">.</span><span class="n">Subsystem</span> <span class="o">==</span> <span class="n">IMAGE_SUBSYSTEM_WINDOWS_GUI</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;(GUI) &quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;(Subsystem:0x%04x) &quot;</span><span class="p">,</span> <span class="n">pe</span><span class="o">-&gt;</span><span class="n">OptionalHeader</span><span class="p">.</span><span class="n">Header32</span><span class="p">.</span><span class="n">Subsystem</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pe</span><span class="o">-&gt;</span><span class="n">OptionalHeader</span><span class="p">.</span><span class="n">Header64</span><span class="p">.</span><span class="n">Subsystem</span> <span class="o">==</span> <span class="n">IMAGE_SUBSYSTEM_WINDOWS_CUI</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;(console) &quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pe</span><span class="o">-&gt;</span><span class="n">OptionalHeader</span><span class="p">.</span><span class="n">Header64</span><span class="p">.</span><span class="n">Subsystem</span> <span class="o">==</span> <span class="n">IMAGE_SUBSYSTEM_WINDOWS_GUI</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;(GUI) &quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;(Subsystem:0x%04x) &quot;</span><span class="p">,</span> <span class="n">pe</span><span class="o">-&gt;</span><span class="n">OptionalHeader</span><span class="p">.</span><span class="n">Header64</span><span class="p">.</span><span class="n">Subsystem</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">switch</span> <span class="p">(</span><span class="n">pe</span><span class="o">-&gt;</span><span class="n">FileHeader</span><span class="p">.</span><span class="n">Machine</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nl">IMAGE_FILE_MACHINE_I386</span><span class="p">:</span>   <span class="n">printf</span><span class="p">(</span><span class="s">&quot;i386&quot;</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">IMAGE_FILE_MACHINE_AMD64</span><span class="p">:</span>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;x86_64&quot;</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span> <span class="n">printf</span><span class="p">(</span><span class="s">&quot; Machine:0x%04x&quot;</span><span class="p">,</span> <span class="n">pe</span><span class="o">-&gt;</span><span class="n">FileHeader</span><span class="p">.</span><span class="n">Machine</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>以上的输出格式和linux下的file命令输出一致。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>demo-x86.exe: PE32 executable (32bits) (console) i386 (Thu Sep 22 16:07:15 2016)
demo-x64.exe: PE32+ executable (console) x86_64 (Thu Sep 22 16:26:42 2016)
</pre></div>
</td></tr></table>

<h2 id="_2">二、导入表</h2>
<p>想要知道依赖哪些DLL，需要关注两个信息，一个是Sections，一个是IMAGE_DATA_DIRECTORY。
大部分的程序是分为.text, .data, .bss等数据段的，Sections里存放了这些段的布局信息。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">_IMAGE_SECTION_HEADER</span> <span class="p">{</span>
  <span class="n">BYTE</span> <span class="n">Name</span><span class="p">[</span><span class="n">IMAGE_SIZEOF_SHORT_NAME</span><span class="p">];</span>
  <span class="k">union</span> <span class="p">{</span>
<span class="n">DWORD</span> <span class="n">PhysicalAddress</span><span class="p">;</span>
<span class="n">DWORD</span> <span class="n">VirtualSize</span><span class="p">;</span>
  <span class="p">}</span> <span class="n">Misc</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">VirtualAddress</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">SizeOfRawData</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">PointerToRawData</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">PointerToRelocations</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">PointerToLinenumbers</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">NumberOfRelocations</span><span class="p">;</span>
  <span class="n">WORD</span> <span class="n">NumberOfLinenumbers</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">Characteristics</span><span class="p">;</span>
<span class="p">}</span> <span class="n">IMAGE_SECTION_HEADER</span><span class="p">,</span><span class="o">*</span><span class="n">PIMAGE_SECTION_HEADER</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>例如用objdump输出文件的Sections信息：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Z:\&gt;objdump -h demo.exe

demo.exe:     file format pei-x86-64

Sections:
Idx Name          Size      VMA               LMA               File off  Algn
  0 .text         00001d38  0000000000401000  0000000000401000  00000400  2**4
                  CONTENTS, ALLOC, LOAD, READONLY, CODE, DATA
  1 .data         000000a8  0000000000403000  0000000000403000  00002200  2**4
                  CONTENTS, ALLOC, LOAD, DATA
  2 .rdata        00000b60  0000000000404000  0000000000404000  00002400  2**4
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  3 .pdata        00000264  0000000000405000  0000000000405000  00003000  2**2
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  4 .xdata        0000021c  0000000000406000  0000000000406000  00003400  2**2
                  CONTENTS, ALLOC, LOAD, READONLY, DATA
  5 .bss          00000a50  0000000000407000  0000000000407000  00000000  2**6
</pre></div>
</td></tr></table>

<p>其中需要关注的就是VMA和LMA，对应数据结构里的VirtualAddress和PointerToRawData。
前者是程序的虚拟地址，后者是加载地址，一般可以理解为文件偏移。
大部分情况下这个Sections表是按照升序排列的（除了恶意修改），
所以先不考虑乱序的问题。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">uint64_t</span> <span class="nf">rva2offset</span><span class="p">(</span><span class="k">const</span> <span class="n">pedump_t</span><span class="o">*</span> <span class="n">pe</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="n">rva</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">pe</span><span class="o">-&gt;</span><span class="n">FileHeader</span><span class="p">.</span><span class="n">NumberOfSections</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rva</span> <span class="o">&gt;=</span> <span class="n">pe</span><span class="o">-&gt;</span><span class="n">sections</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">VirtualAddress</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">rva</span> <span class="o">-</span> <span class="n">pe</span><span class="o">-&gt;</span><span class="n">sections</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">VirtualAddress</span> <span class="o">+</span> <span class="n">pe</span><span class="o">-&gt;</span><span class="n">sections</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">PointerToRawData</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>EXE/DLL的导入信息在IMAGE_OPTIONAL_HEADER的DataDirectory里：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="p">......</span>
  <span class="n">DWORD</span> <span class="n">NumberOfRvaAndSizes</span><span class="p">;</span>
  <span class="n">IMAGE_DATA_DIRECTORY</span> <span class="n">DataDirectory</span><span class="p">[</span><span class="n">IMAGE_NUMBEROF_DIRECTORY_ENTRIES</span><span class="p">];</span>
<span class="p">}</span> <span class="n">IMAGE_OPTIONAL_HEADER64</span><span class="p">,</span><span class="o">*</span><span class="n">PIMAGE_OPTIONAL_HEADER64</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>IMAGE_DATA_DIRECTORY的定义如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">_IMAGE_DATA_DIRECTORY</span> <span class="p">{</span>
  <span class="n">DWORD</span> <span class="n">VirtualAddress</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">Size</span><span class="p">;</span>
<span class="p">}</span> <span class="n">IMAGE_DATA_DIRECTORY</span><span class="p">,</span><span class="o">*</span><span class="n">PIMAGE_DATA_DIRECTORY</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p><span></span></p>
<p>每个表的用途如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#define IMAGE_DIRECTORY_ENTRY_EXPORT            0   </span><span class="c1">//函数导出表</span>
<span class="cp">#define IMAGE_DIRECTORY_ENTRY_IMPORT            1   </span><span class="c1">//函数导入表</span>
<span class="cp">#define IMAGE_DIRECTORY_ENTRY_RESOURCE          2   </span><span class="c1">//资源表</span>
<span class="cp">#define IMAGE_DIRECTORY_ENTRY_EXCEPTION         3</span>
<span class="cp">#define IMAGE_DIRECTORY_ENTRY_SECURITY          4</span>
<span class="cp">#define IMAGE_DIRECTORY_ENTRY_BASERELOC         5</span>
<span class="cp">#define IMAGE_DIRECTORY_ENTRY_DEBUG             6</span>
<span class="cp">#define IMAGE_DIRECTORY_ENTRY_ARCHITECTURE      7</span>
<span class="cp">#define IMAGE_DIRECTORY_ENTRY_GLOBALPTR         8</span>
<span class="cp">#define IMAGE_DIRECTORY_ENTRY_TLS               9</span>
<span class="cp">#define IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG       10</span>
<span class="cp">#define IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT      11</span>
<span class="cp">#define IMAGE_DIRECTORY_ENTRY_IAT               12</span>
<span class="cp">#define IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT      13</span>
<span class="cp">#define IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR    14</span>
</pre></div>
</td></tr></table>

<p>本文只关心导入表，我们需要区别处理32位和64位格式，导入表的结构如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">_IMAGE_IMPORT_DESCRIPTOR</span> <span class="p">{</span>
  <span class="k">union</span> <span class="p">{</span>
    <span class="n">DWORD</span> <span class="n">Characteristics</span><span class="p">;</span>
        <span class="n">DWORD</span> <span class="n">OriginalFirstThunk</span><span class="p">;</span>
  <span class="p">}</span> <span class="n">DUMMYUNIONNAME</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">TimeDateStamp</span><span class="p">;</span>

  <span class="n">DWORD</span> <span class="n">ForwarderChain</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">Name</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">FirstThunk</span><span class="p">;</span>
<span class="p">}</span> <span class="n">IMAGE_IMPORT_DESCRIPTOR</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>每个导入项对应一个DLL，其中Name是虚拟地址偏移，需要转换为实际的文件偏移，
而OriginalFirstThunk对应的是导入函数列表，暂时不管，以下代码仅仅显示导入的DLL：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">parse_import_directory</span><span class="p">(</span><span class="k">const</span> <span class="n">pedump_t</span><span class="o">*</span> <span class="n">pe</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span> <span class="n">buf</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">IMAGE_DATA_DIRECTORY</span> <span class="n">dir</span><span class="p">;</span>
    <span class="n">PIMAGE_IMPORT_DESCRIPTOR</span> <span class="n">imp</span><span class="p">;</span>
    <span class="kt">uint64_t</span> <span class="n">offset</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">pe</span><span class="o">-&gt;</span><span class="n">FileHeader</span><span class="p">.</span><span class="n">Machine</span> <span class="o">==</span> <span class="n">IMAGE_FILE_MACHINE_I386</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">dir</span> <span class="o">=</span> <span class="n">pe</span><span class="o">-&gt;</span><span class="n">OptionalHeader</span><span class="p">.</span><span class="n">Header32</span><span class="p">.</span><span class="n">DataDirectory</span><span class="p">[</span><span class="n">IMAGE_DIRECTORY_ENTRY_IMPORT</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">dir</span> <span class="o">=</span> <span class="n">pe</span><span class="o">-&gt;</span><span class="n">OptionalHeader</span><span class="p">.</span><span class="n">Header64</span><span class="p">.</span><span class="n">DataDirectory</span><span class="p">[</span><span class="n">IMAGE_DIRECTORY_ENTRY_IMPORT</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="n">offset</span> <span class="o">=</span> <span class="n">rva2offset</span><span class="p">(</span><span class="n">pe</span><span class="p">,</span> <span class="n">dir</span><span class="p">.</span><span class="n">VirtualAddress</span><span class="p">);</span>
    <span class="n">imp</span> <span class="o">=</span> <span class="p">(</span><span class="n">PIMAGE_IMPORT_DESCRIPTOR</span><span class="p">)(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">offset</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(;;</span><span class="n">imp</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">imp</span><span class="o">-&gt;</span><span class="n">OriginalFirstThunk</span> <span class="o">&amp;&amp;</span>
            <span class="o">!</span><span class="n">imp</span><span class="o">-&gt;</span><span class="n">TimeDateStamp</span> <span class="o">&amp;&amp;</span>
            <span class="o">!</span><span class="n">imp</span><span class="o">-&gt;</span><span class="n">ForwarderChain</span> <span class="o">&amp;&amp;</span>
            <span class="o">!</span><span class="n">imp</span><span class="o">-&gt;</span><span class="n">Name</span> <span class="o">&amp;&amp;</span>
            <span class="o">!</span><span class="n">imp</span><span class="o">-&gt;</span><span class="n">FirstThunk</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;  Import %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">rva2offset</span><span class="p">(</span><span class="n">pe</span><span class="p">,</span> <span class="n">imp</span><span class="o">-&gt;</span><span class="n">Name</span><span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>最后的程序输出结果，explorer.exe：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>c:\Windows\explorer.exe: PE32+ executable (GUI) x86_64 (Sat Nov 20 18:21:56 2010)
  Import ADVAPI32.dll
  Import KERNEL32.dll
  Import GDI32.dll
  Import USER32.dll
  Import msvcrt.dll
  Import ntdll.dll
  Import SHLWAPI.dll
  Import SHELL32.dll
  Import ole32.dll
  Import OLEAUT32.dll
  Import EXPLORERFRAME.dll
  Import UxTheme.dll
  Import POWRPROF.dll
  Import dwmapi.dll
  Import slc.dll
  Import gdiplus.dll
  Import Secur32.dll
  Import RPCRT4.dll
  Import PROPSYS.dll
</pre></div>
</td></tr></table>

<p>shell32.dll</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>c:\Windows\System32\shell32.dll: PE32 executable (DLL) (32bits) (GUI) i386 (Sat Nov 20 20:06:54 2010)
  Import msvcrt.dll
  Import KERNELBASE.dll
  Import API-MS-Win-Core-Debug-L1-1-0.dll
  Import API-MS-Win-Core-ErrorHandling-L1-1-0.dll
  Import API-MS-Win-Core-File-L1-1-0.dll
  Import API-MS-Win-Core-Handle-L1-1-0.dll
  Import API-MS-Win-Core-Heap-L1-1-0.dll
  Import API-MS-Win-Core-Interlocked-L1-1-0.dll
  Import API-MS-Win-Core-IO-L1-1-0.dll
  Import API-MS-Win-Core-LibraryLoader-L1-1-0.dll
  Import API-MS-Win-Core-Localization-L1-1-0.dll
  Import API-MS-Win-Core-LocalRegistry-L1-1-0.dll
  Import API-MS-Win-Core-Memory-L1-1-0.dll
  Import API-MS-Win-Core-Misc-L1-1-0.dll
  Import API-MS-Win-Core-ProcessEnvironment-L1-1-0.dll
  Import API-MS-Win-Core-ProcessThreads-L1-1-0.dll
  Import API-MS-Win-Core-Profile-L1-1-0.dll
  Import API-MS-Win-Core-String-L1-1-0.dll
  Import API-MS-Win-Core-Synch-L1-1-0.dll
  Import API-MS-Win-Core-SysInfo-L1-1-0.dll
  Import API-MS-Win-Security-Base-L1-1-0.dll
  Import SHLWAPI.dll
  Import ntdll.dll
  Import USER32.dll
  Import GDI32.dll
  Import KERNEL32.dll
  Export SHELL32.dll
</pre></div>
</td></tr></table>

<p>Qt5Core.dll:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Qt5Core.dll: PE32 executable (DLL) (32bits) (GUI) i386 (Fri Jun 10 15:20:20 2016)
  Import KERNEL32.dll
  Import USER32.dll
  Import SHELL32.dll
  Import ole32.dll
  Import ADVAPI32.dll
  Import WS2_32.dll
  Import MPR.dll
  Import MSVCP120.dll
  Import MSVCR120.dll
  Export Qt5Core.dll
</pre></div>
</td></tr></table>

</body>
</html>
